<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Fashion Content Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body{font-family:'Inter',sans-serif}.form-label{@apply block text-sm font-medium text-gray-700 mb-2}.form-input,.form-select{@apply block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm}.custom-checkbox-label{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1rem;border-width:2px;border-color:#d1d5db;border-radius:.5rem;cursor:pointer;transition:background-color .2s,border-color .2s,box-shadow .2s;height:100%}.custom-checkbox-label:hover{border-color:#6366f1;background-color:#eef2ff}input[type=checkbox]:checked+.custom-checkbox-label{border-color:#4f46e5;background-color:#e0e7ff;box-shadow:0 0 0 2px #6366f1}.custom-radio-button{@apply w-full text-center px-4 py-2 border rounded-md cursor-pointer transition-colors duration-200}input[type=radio]:checked+.custom-radio-button{@apply bg-indigo-600 text-white border-indigo-600}.spinner{border-top-color:#4f46e5;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.skeleton{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes pulse{50%{opacity:.5}}
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div id="admin-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-sm w-full relative">
            <div id="login-view"><h2 class="text-2xl font-bold mb-4 text-center">Admin Login</h2><form id="login-form"><div class="mb-4"><label for="password" class="form-label">Password</label><input type="password" id="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div><p id="login-error" class="text-red-500 text-sm mb-4 hidden">Password salah.</p><button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700">Login</button></form></div>
            <div id="settings-view" class="hidden"><h2 class="text-2xl font-bold mb-4">API Settings</h2><div class="mb-4"><label for="api-key" class="form-label">Google AI API Key</label><input type="text" id="api-key" class="form-input" placeholder="Masukkan API Key Anda"><p class="text-xs text-gray-500 mt-1">Dapatkan kunci gratis dari Google AI Studio.</p></div><button id="save-settings-btn" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700">Simpan & Tutup</button></div>
            <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59L7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12L5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"/></svg></button>
        </div>
    </div>
    <div class="container mx-auto p-4 md:p-8">
        <header class="flex justify-between items-center mb-8">
            <div><h1 class="text-3xl md:text-4xl font-bold text-gray-900">AI Fashion Content Simulator</h1><p class="text-gray-600 mt-1">Buat konten fashion Anda secara bertahap dengan AI.</p></div>
            <button id="admin-btn" class="bg-white border border-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-100 text-sm font-medium flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 7h-9"/><path d="M14 17H5"/><circle cx="17" cy="17" r="3"/><circle cx="7" cy="7" r="3"/></svg> Admin</button>
        </header>
        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <form id="content-form"><div class="space-y-6"><div><label class="form-label">1. Unggah Gambar Produk</label><div id="image-drop-zone" class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md"><div class="space-y-1 text-center"><svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 4v.01M28 8L36 16m0 0v12a4 4 0 01-4 4H12a4 4 0 01-4-4V12a4 4 0 014-4h12.586a1 1 0 01.707.293l2.414 2.414a1 1 0 00.707.293H36z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg><div class="flex text-sm text-gray-600"><label for="product-image" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500"><span>Unggah file</span><input id="product-image" type="file" class="sr-only" accept="image/*"></label><p class="pl-1">atau tarik dan lepas</p></div></div></div><div id="image-preview-container" class="mt-4 hidden"><p class="form-label">Pratinjau Produk:</p><img id="image-preview" src="" alt="Image Preview" class="rounded-md object-cover max-h-40 mx-auto"/></div></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="product-name" class="form-label">Nama Produk</label><input type="text" id="product-name" class="form-input" placeholder="Contoh: Urban Explorer Hoodie"></div><div><label for="product-type" class="form-label">Jenis Produk</label><select id="product-type" class="form-select"><option>Hoodie</option><option>Kaos</option><option>Jaket</option><option>Celana</option><option>Topi</option><option>Kemeja</option></select></div></div>
                    <div><label class="form-label">2. Konsep Foto (Bisa pilih lebih dari satu)</label><div class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-2"><div><input type="checkbox" name="concept" id="concept-tropical" value="Minimalis Tropis" class="sr-only" checked><label for="concept-tropical" class="custom-checkbox-label"><span>üåø</span><span class="text-sm font-medium text-center">Minimalis Tropis</span></label></div><div><input type="checkbox" name="concept" id="concept-dramatic" value="Dramatik & Berani" class="sr-only"><label for="concept-dramatic" class="custom-checkbox-label"><span>üî•</span><span class="text-sm font-medium text-center">Dramatik & Berani</span></label></div><div><input type="checkbox" name="concept" id="concept-elegant" value="Elegan & Profesional" class="sr-only"><label for="concept-elegant" class="custom-checkbox-label"><span>‚ú®</span><span class="text-sm font-medium text-center">Elegan & Profesional</span></label></div><div><input type="checkbox" name="concept" id="concept-streetwear" value="Urban Streetwear" class="sr-only"><label for="concept-streetwear" class="custom-checkbox-label"><span>üèôÔ∏è</span><span class="text-sm font-medium text-center">Urban Streetwear</span></label></div><div><input type="checkbox" name="concept" id="concept-studio" value="Studio Minimalis" class="sr-only"><label for="concept-studio" class="custom-checkbox-label"><span>üß±</span><span class="text-sm font-medium text-center">Studio Minimalis</span></label></div></div></div>
                    <div><label class="form-label">3. Opsi Kustom Model</label><div class="grid grid-cols-2 gap-4"><div><input type="radio" name="model" id="model-pria" value="Pria" class="sr-only" checked><label for="model-pria" class="custom-radio-button">Pria</label></div><div><input type="radio" name="model" id="model-wanita" value="Wanita" class="sr-only"><label for="model-wanita" class="custom-radio-button">Wanita</label></div><div class="col-span-2"><input type="radio" name="model" id="model-referensi" value="Referensi" class="sr-only"><label for="model-referensi" class="custom-radio-button">Referensi Wajah</label></div></div><div id="face-reference-container" class="mt-4 hidden"><label for="face-image" class="form-label">Unggah Foto Wajah</label><input type="file" id="face-image" class="form-input" accept="image/*"><div id="face-preview-container" class="mt-2 hidden text-center"><img id="face-preview" src="" alt="Face Preview" class="rounded-md object-cover max-h-32 mx-auto"/></div></div></div>
                    <div><label for="background-select" class="form-label">4. Latar Belakang</label><select id="background-select" class="form-select"><option value="default">Latar Bawaan Konsep</option><option value="custom">Latar Kustom</option></select><textarea id="custom-background-text" class="form-input mt-3 hidden" placeholder="Jelaskan latar belakang kustom..."></textarea></div>
                    <div><button id="generate-foto-btn" type="submit" class="w-full flex justify-center items-center gap-3 py-3 px-4 rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-300"><span>1. Generate Foto</span><div id="btn-spinner" class="spinner h-5 w-5 rounded-full border-2 border-t-2 border-white hidden"></div></button><p id="error-message" class="text-red-500 text-sm mt-3 text-center"></p></div></div></form>
            </div>
            <div id="output-container" class="bg-white p-6 rounded-lg shadow-md space-y-6">
                <div id="placeholder" class="text-center text-gray-500 h-full flex flex-col justify-center items-center"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m21.64 3.64l-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.21 1.21 0 0 0 1.72 0L21.64 5.36a1.21 1.21 0 0 0 0-1.72Z"/><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m14 7l3 3m-9 6v4m11-4v4M10 2v2M7 8H3m18-2h-4m-6-3H9"/></svg><h3 class="text-lg font-medium">Hasil Generasi AI Anda</h3><p class="mt-1">Konten yang dihasilkan akan muncul di sini.</p></div>
                <div id="image-result-section" class="hidden"><h2 class="text-xl font-semibold mb-3">üì∏ Foto Produk Hasil AI (9:16)</h2><div id="image-loader" class="w-full aspect-[9/16] bg-gray-200 rounded-lg skeleton flex items-center justify-center"><p class="text-gray-500">Menghasilkan gambar...</p></div><img id="generated-image" src="" alt="AI Generated Product" class="w-full rounded-lg shadow-sm hidden"></div>
                <div id="manual-controls" class="hidden space-y-6">
                    <div class="space-y-4 p-4 border rounded-lg bg-gray-50"><h3 class="font-semibold text-lg">2. Generate Teks</h3><div class="grid grid-cols-1 sm:grid-cols-2 gap-3"><button id="generate-deskripsi-btn" class="w-full text-sm py-2 px-3 rounded-md shadow-sm text-white bg-slate-600 hover:bg-slate-700 flex items-center justify-center gap-2">Generate Deskripsi</button><button id="generate-narasi-btn" class="w-full text-sm py-2 px-3 rounded-md shadow-sm text-white bg-slate-600 hover:bg-slate-700 flex items-center justify-center gap-2">Generate Narasi</button></div><div id="deskripsi-result-section" class="hidden"><h4 class="font-medium mb-2">üìù Deskripsi TikTok</h4><div id="caption-loader" class="skeleton w-full h-16 rounded-md"></div><p id="tiktok-caption" class="text-gray-700 bg-gray-100 p-3 rounded-md hidden whitespace-pre-wrap"></p></div><div id="narasi-result-section" class="hidden"><h4 class="font-medium mb-2">üí¨ Narasi Promosi</h4><div id="narrative-loader" class="skeleton w-full h-24 rounded-md"></div><p id="narrative-text" class="text-gray-700 bg-gray-100 p-3 rounded-md hidden whitespace-pre-wrap"></p></div></div>
                    <div class="space-y-4 p-4 border rounded-lg bg-gray-50"><h3 class="font-semibold text-lg">3. Generate Prompt Video</h3><button id="generate-prompt-btn" class="w-full text-sm py-2 px-3 rounded-md shadow-sm text-white bg-slate-600 hover:bg-slate-700 flex items-center justify-center gap-2">Generate Prompt</button><div id="prompt-result-section" class="hidden"><h4 class="font-medium mb-2">üí° Ide Prompt Video</h4><div id="prompt-loader" class="skeleton w-full h-28 rounded-md"></div><div id="prompt-content" class="hidden"><textarea id="video-prompt" readonly class="form-input w-full h-32 bg-gray-100"></textarea><button id="copy-prompt-btn" class="mt-2 text-sm w-full py-2 px-3 rounded-md bg-gray-200 hover:bg-gray-300">Salin Teks</button></div></div></div>
                    <div class="space-y-4 p-4 border rounded-lg bg-gray-50"><h3 class="font-semibold text-lg">4. Generate Voice Over</h3><button id="generate-audio-btn" class="w-full text-sm py-2 px-3 rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 flex items-center justify-center gap-2" disabled>Generate Audio</button><div id="audio-result-section" class="hidden"><div id="audio-male-loader" class="skeleton w-full h-12 rounded-full mb-2"></div><audio id="audio-player-male" controls class="w-full hidden"></audio><div id="audio-female-loader" class="skeleton w-full h-12 rounded-full mt-3"></div><audio id="audio-player-female" controls class="w-full hidden mt-2"></audio></div></div>
                </div>
            </div>
        </main>
    </div>
    <script type="module">
        const form=document.getElementById("content-form"),generateFotoBtn=document.getElementById("generate-foto-btn"),btnSpinner=document.getElementById("btn-spinner"),errorMessage=document.getElementById("error-message"),imageInput=document.getElementById("product-image"),imageDropZone=document.getElementById("image-drop-zone"),imagePreviewContainer=document.getElementById("image-preview-container"),imagePreview=document.getElementById("image-preview"),productNameInput=document.getElementById("product-name"),productTypeSelect=document.getElementById("product-type"),customBgText=document.getElementById("custom-background-text"),backgroundSelect=document.getElementById("background-select"),faceReferenceContainer=document.getElementById("face-reference-container"),faceImageInput=document.getElementById("face-image"),facePreviewContainer=document.getElementById("face-preview-container"),facePreview=document.getElementById("face-preview"),placeholder=document.getElementById("placeholder"),imageResultSection=document.getElementById("image-result-section"),generatedImage=document.getElementById("generated-image"),imageLoader=document.getElementById("image-loader"),manualControls=document.getElementById("manual-controls"),generateDeskripsiBtn=document.getElementById("generate-deskripsi-btn"),generateNarasiBtn=document.getElementById("generate-narasi-btn"),generatePromptBtn=document.getElementById("generate-prompt-btn"),generateAudioBtn=document.getElementById("generate-audio-btn"),copyPromptBtn=document.getElementById("copy-prompt-btn"),deskripsiResultSection=document.getElementById("deskripsi-result-section"),narasiResultSection=document.getElementById("narasi-result-section"),promptResultSection=document.getElementById("prompt-result-section"),audioResultSection=document.getElementById("audio-result-section"),captionLoader=document.getElementById("caption-loader"),tiktokCaption=document.getElementById("tiktok-caption"),narrativeLoader=document.getElementById("narrative-loader"),narrativeText=document.getElementById("narrative-text"),promptLoader=document.getElementById("prompt-loader"),promptContent=document.getElementById("prompt-content"),videoPrompt=document.getElementById("video-prompt"),audioMaleLoader=document.getElementById("audio-male-loader"),audioPlayerMale=document.getElementById("audio-player-male"),audioFemaleLoader=document.getElementById("audio-female-loader"),audioPlayerFemale=document.getElementById("audio-player-female"),adminModal=document.getElementById("admin-modal"),adminBtn=document.getElementById("admin-btn"),closeModalBtn=document.getElementById("close-modal-btn"),loginForm=document.getElementById("login-form"),passwordInput=document.getElementById("password"),loginError=document.getElementById("login-error"),loginView=document.getElementById("login-view"),settingsView=document.getElementById("settings-view"),apiKeyInput=document.getElementById("api-key"),saveSettingsBtn=document.getElementById("save-settings-btn");let uploadedImageBase64=null,faceReferenceBase64=null,currentFormData=null;const sleep=e=>new Promise(t=>setTimeout(t,e)),toggleSectionLoading=(e,t,o,a)=>{e&&(e.disabled=a),a?(t.style.display="block",o&&(o.style.display="none")):(t.style.display="none",o&&(o.style.display="block"))},handleProductFiles=e=>{const t=e[0];t&&t.type.startsWith("image/")&&(const o=new FileReader;o.onload=e=>{uploadedImageBase64=e.target.result.split(",")[1],imagePreview.src=e.target.result,imagePreviewContainer.classList.remove("hidden"),errorMessage.textContent=""},o.readAsDataURL(t))};imageInput.addEventListener("change",e=>handleProductFiles(e.target.files)),["dragenter","dragover","dragleave","drop"].forEach(e=>{imageDropZone.addEventListener(e,e=>{e.preventDefault(),e.stopPropagation()})}),imageDropZone.addEventListener("drop",e=>handleProductFiles(e.dataTransfer.files)),faceImageInput.addEventListener("change",e=>{const t=e.target.files[0];t&&t.type.startsWith("image/")&&(const o=new FileReader;o.onload=e=>{faceReferenceBase64=e.target.result.split(",")[1],facePreview.src=e.target.result,facePreviewContainer.classList.remove("hidden")},o.readAsDataURL(t))}),document.querySelectorAll('input[name="model"]').forEach(e=>{e.addEventListener("change",e=>{"Referensi"===e.target.value?faceReferenceContainer.classList.remove("hidden"):(faceReferenceContainer.classList.add("hidden"),faceReferenceBase64=null,facePreviewContainer.classList.add("hidden"),faceImageInput.value="")})}),backgroundSelect.addEventListener("change",e=>{customBgText.classList.toggle("hidden","custom"!==e.target.value)}),form.addEventListener("submit",async e=>{e.preventDefault();const t=Array.from(document.querySelectorAll('input[name="concept"]:checked')),o=document.querySelector('input[name="model"]:checked').value;if(!uploadedImageBase64||!productNameInput.value)return void(errorMessage.textContent="Mohon unggah gambar produk dan isi nama produk.");if(0===t.length)return void(errorMessage.textContent="Mohon pilih minimal satu konsep foto.");if("Referensi"===o&&!faceReferenceBase64)return void(errorMessage.textContent="Mohon unggah foto wajah untuk referensi.");errorMessage.textContent="",currentFormData={productName:productNameInput.value,productType:productTypeSelect.value,concept:t.map(e=>e.value).join(", "),model:o,backgroundType:backgroundSelect.value,customBackground:customBgText.value,imageBase64:uploadedImageBase64,faceBase64:faceReferenceBase64};try{const e=getApiKey();generateFotoBtn.disabled=!0,btnSpinner.classList.remove("hidden"),placeholder.classList.add("hidden"),manualControls.classList.add("hidden"),imageResultSection.classList.remove("hidden"),imageLoader.style.display="flex",generatedImage.classList.add("hidden");const t=await generateImage(currentFormData,e);t?(generatedImage.src=t,generatedImage.onload=()=>{imageLoader.style.display="none",generatedImage.classList.remove("hidden"),manualControls.classList.remove("hidden")}):(()=>{throw new Error("Gagal membuat gambar.")})()}catch(e){errorMessage.textContent=`Error: ${e.message}`,imageResultSection.classList.add("hidden"),placeholder.classList.remove("hidden")}finally{generateFotoBtn.disabled=!1,btnSpinner.classList.add("hidden")}}),generateDeskripsiBtn.addEventListener("click",async()=>{deskripsiResultSection.classList.remove("hidden"),toggleSectionLoading(generateDeskripsiBtn,captionLoader,tiktokCaption,!0);try{const e=await generateCaption(currentFormData,getApiKey());tiktokCaption.textContent=e}catch(e){tiktokCaption.textContent=`Gagal membuat deskripsi: ${e.message}`}finally{toggleSectionLoading(generateDeskripsiBtn,captionLoader,tiktokCaption,!1)}}),generateNarasiBtn.addEventListener("click",async()=>{narasiResultSection.classList.remove("hidden"),toggleSectionLoading(generateNarasiBtn,narrativeLoader,narrativeText,!0);try{const e=await generateNarrative(currentFormData,getApiKey());narrativeText.textContent=e,generateAudioBtn.disabled=!1}catch(e){narrativeText.textContent=`Gagal membuat narasi: ${e.message}`}finally{toggleSectionLoading(generateNarasiBtn,narrativeLoader,narrativeText,!1)}}),generatePromptBtn.addEventListener("click",async()=>{promptResultSection.classList.remove("hidden"),toggleSectionLoading(generatePromptBtn,promptLoader,promptContent,!0);try{const e=await generateVideoPrompt(currentFormData,getApiKey());videoPrompt.value=e}catch(e){videoPrompt.value=`Gagal membuat prompt: ${e.message}`}finally{toggleSectionLoading(generatePromptBtn,promptLoader,promptContent,!1)}}),copyPromptBtn.addEventListener("click",()=>{videoPrompt.select(),document.execCommand("copy"),copyPromptBtn.textContent="Tersalin!",setTimeout(()=>{copyPromptBtn.textContent="Salin Teks"},2e3)}),generateAudioBtn.addEventListener("click",async()=>{audioResultSection.classList.remove("hidden"),generateAudioBtn.disabled=!0,audioMaleLoader.style.display="block",audioFemaleLoader.style.display="block",audioPlayerMale.classList.add("hidden"),audioPlayerFemale.classList.add("hidden");const e=narrativeText.textContent;if(!e||e.startsWith("Gagal"))return void(errorMessage.textContent="Tidak ada narasi valid untuk dibuat audio.");try{const[t,o]=await Promise.all([generateTTS(e,"male",getApiKey()),generateTTS(e,"female",getApiKey())]);audioPlayerMale.src=t,audioMaleLoader.style.display="none",audioPlayerMale.classList.remove("hidden"),audioPlayerFemale.src=o,audioFemaleLoader.style.display="none",audioPlayerFemale.classList.remove("hidden")}catch(e){errorMessage.textContent=`Gagal membuat audio: ${e.message}`,audioMaleLoader.style.display="none",audioFemaleLoader.style.display="none"}}),adminBtn.addEventListener("click",()=>{passwordInput.value="",loginError.classList.add("hidden"),loginView.classList.remove("hidden"),settingsView.classList.add("hidden"),adminModal.style.display="flex"}),closeModalBtn.addEventListener("click",()=>adminModal.style.display="none"),saveSettingsBtn.addEventListener("click",()=>{localStorage.setItem("geminiApiKey",apiKeyInput.value),adminModal.style.display="none"}),loginForm.addEventListener("submit",e=>{e.preventDefault(),"admin123"===passwordInput.value?(loginView.classList.add("hidden"),settingsView.classList.remove("hidden"),loginError.classList.add("hidden"),apiKeyInput.value=localStorage.getItem("geminiApiKey")||""):loginError.classList.remove("hidden")}),document.addEventListener("DOMContentLoaded",()=>{apiKeyInput.value=localStorage.getItem("geminiApiKey")||""});async function makeApiCall(e,t){const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok){const e=await o.json();throw new Error(e.error?.message||`API request failed: ${o.status}`)}return o.json()}async function generateImage({imageBase64:e,faceBase64:t,productName:o,productType:a,concept:r,model:n,backgroundType:s,customBackground:i},l){const d={ "Minimalis Tropis": "a minimalist tropical setting, lush green leaves, natural light", "Dramatik & Berani": "dramatic, high-contrast lighting, bold shadows, intense mood", "Elegan & Profesional": "a sophisticated indoor setting, soft and elegant lighting", "Urban Streetwear": "a city street, graffiti wall, neon lights, dynamic pose", "Studio Minimalis": "a clean photo studio with a simple solid color background"},c=r.split(", ").map(e=>d[e]).filter(Boolean).join(", blending elements of ");let m="custom"===s&&i?`a custom background: ${i}`:c;const p="Wanita"===n?"female":"male",u="The final image must have a 9:16 aspect ratio.";let g;const h=[];if("Referensi"===n&&t)g=`Professional fashion photo. A model wearing the product from the FIRST image. The model's face MUST realistically match the person in the SECOND reference image. Concept: "${r}". Setting: ${m}. Style: photorealistic, high-detail, Indonesian model. ${u}`,h.push({text:g},{inlineData:{mimeType:"image/jpeg",data:e}},{inlineData:{mimeType:"image/jpeg",data:t}});else{g=`Professional fashion photo of a realistic ${p} Indonesian model wearing the uploaded ${a} product. Concept: "${r}". Setting: ${m}. Style: photorealistic, high-detail. ${u}`,h.push({text:g},{inlineData:{mimeType:"image/jpeg",data:e}})}const f={contents:[{parts:h}],generationConfig:{responseModalities:["IMAGE"]}},b=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${l}`;const w=await makeApiCall(b,f),y=w?.candidates?.[0]?.content?.parts?.find(e=>e.inlineData)?.inlineData?.data;if(!y)throw new Error("Could not extract image data from API response.");return`data:image/png;base64,${y}`}async function generateCaption({productName:e,concept:t},o){const a=`Buatkan caption TikTok (2-3 kalimat, casual, persuasif, dengan emoji) untuk produk "${e}" dengan konsep foto "${t}" untuk audiens muda Indonesia.`,r={contents:[{parts:[{text:a}]}]},n=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${o}`;return(await makeApiCall(n,r)).candidates[0].content.parts[0].text}async function generateNarrative({productName:e,concept:t},o){const a=`Buatkan narasi promosi (sekitar 20 detik, gaya bicara natural seperti teman) untuk voice-over video TikTok/Reels. Produknya adalah "${e}" dengan konsep visual "${t}".`,r={contents:[{parts:[{text:a}]}]},n=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${o}`;return(await makeApiCall(n,r)).candidates[0].content.parts[0].text}async function generateVideoPrompt({productName:e,concept:t},o){const a=`Berikan 3 ide prompt video pendek yang kreatif dalam format daftar bernomor untuk promosi TikTok/Reels. Produknya adalah "${e}" dengan konsep "${t}". Setiap prompt harus menjelaskan adegan dan angle kamera secara singkat.`,r={contents:[{parts:[{text:a}]}]},n=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${o}`;return(await makeApiCall(n,r)).candidates[0].content.parts[0].text}async function generateTTS(e,t,o){const a="male"===t?"Kore":"Puck",r="male"===t?"Katakan dengan nada santai dan percaya diri":"Katakan dengan nada lembut dan bersemangat",n={contents:[{parts:[{text:`${r}: ${e}`}]}],generationConfig:{responseModalities:["AUDIO"],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:a}}}},model:"gemini-2.5-flash-preview-tts"},s=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${o}`;const i=await makeApiCall(s,n),l=i?.candidates?.[0]?.content?.parts?.[0];if(!l?.inlineData?.data)throw new Error(`TTS generation failed for ${t}.`);const d=parseInt(l.inlineData.mimeType.match(/rate=(\d+)/)[1],10),c=base64ToArrayBuffer(l.inlineData.data),m=new Int16Array(c);return URL.createObjectURL(pcmToWav(m,1,d))}function getApiKey(){const e=localStorage.getItem("geminiApiKey");if(!e||""===e.trim())throw errorMessage.textContent="API Key belum diatur. Silakan atur di menu Admin.",new Error("API Key is not set.");return e}function base64ToArrayBuffer(e){const t=atob(e),o=t.length,a=new Uint8Array(o);for(let e=0;e<o;e++)a[e]=t.charCodeAt(e);return a.buffer}function pcmToWav(e,t,o){const a=new ArrayBuffer(44+2*e.length),r=new DataView(a),n=(e,t,o)=>{for(let a=0;a<o.length;a++)e.setUint8(t+a,o.charCodeAt(a))};return n(r,0,"RIFF"),r.setUint32(4,36+2*e.length,!0),n(r,8,"WAVE"),n(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,t,!0),r.setUint32(24,o,!0),r.setUint32(28,2*o*t,!0),r.setUint16(32,2*t,!0),r.setUint16(34,16,!0),n(r,36,"data"),r.setUint32(40,2*e.length,!0),(()=>{for(let t=0;t<e.length;t++)r.setInt16(44+2*t,e[t],!0)})(),new Blob([r],{type:"audio/wav"})}
    </script>
</body>
</html>